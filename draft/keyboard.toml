[keyboard]
name = "draft keyboard"
product_name = "draft kbd"
vendor_id = 0x4c4b
product_id = 0x4643
manufacturer = "tib"
chip = "nrf52840"
# serial_number = "vial:f64c2b3c:000001"
#board = "nice!nano_v2"
# USB is enabled by default for most chips
# Set to false if you don't want USB
#usb_enable = true

[layout]
rows = 4
cols = 12
layers = 8
keymap = [
    #0 Hunglish layer
    [
        ["No", "No",                "D", "G", "K", "B",                                    "W", "Y", "O", "U", "No", "No"],
        ["WM(Right, LShift)",  "M", "MT(S,LAlt)", "MT(T,LShift)", "MT(L,LCtrl)", "F",      "J", "MT(R,RCtrl)", "MT(A,RShift)", "MT(E,LAlt)", "Equal", "WM(LeftBracket, LShift)"],
        ["WM(Kc0, LShift)", "MT(N,LGui)", "V", "P", "H", "Q",                              "X", "Z", "Dot", "Semicolon", "MT(I,RGui)", "WM(Kc9, LShift)"],
        ["WM(Quote, LShift)", "C", "No", "LT(2, Space)", "LT(4,Tab)", "LT(5,Escape)",      "No", "LT(3,Enter)", "LT(2,Backspace)", "LT(4,Delete)", "Comma", "Slash"]
    ],

    #1 Hun mods
    [
        ["No", "No", "_", "_", "_", "_",              "_", "_", "_", "_", "No", "No"],
        ["Minus", "_", "_", "_", "_", "_",            "_", "_", "_", "_", "Quote", "Kp0"],
        ["Equal", "_", "_", "_", "_", "_",      "_", "_", "_", "WM(Comma, RAlt)", "_", "Semicolon"],
        ["Grave", "_", "No", "_", "_", "_",           "No", "_", "_", "_", "_", "LeftBracket"]
    ],

    #2 Sym + Numpad
    [
        ["_", "_", "WM(Kc7, LShift)", "LeftBracket", "RightBracket", "Quote",                                                       "WM(Grave, LShift)", "Kp7", "Kp8", "Kp9", "_", "_"],
        ["Grave", "WM(Backslash, LShift)", "WM(RightBracket, LShift)", "WM(Kc9, LShift)", "WM(Kc0, LShift)", "WM(Quote, LShift)",   "KpDot", "Kp4", "Kp5", "Kp6", "KpSlash", "KpAsterisk"],
        ["Backslash", "WM(LeftBracket, LShift)", "WM(Kc3, LShift)", "WM(Comma, LShift)", "WM(Dot, LShift)", "Equal",                "Kp0", "Kp1", "Kp2", "Kp3", "KpMinus", "KpPlus"],
        ["WM(Kc4, LShift)", "WM(Kc2, LShift)", "_", "WM(Minus, LShift)", "_", "_",                                                  "_", "_", "_", "_", "WM(Kc6, LShift)", "WM(Kc5, LShift)"]
    ],
    
    #3 Fn + Media
    [
        ["_", "_", "F7", "F8", "F9", "F10",                    "WwwRefresh", "MediaPrevTrack", "MediaNextTrack", "Bootloader", "_", "_"],
        ["NumLock", "PrintScreen", "F4", "F5", "F6", "F11",    "WwwForward", "MediaPlayPause", "MediaStop", "TG(1)", "BrightnessUp", "AudioVolUp"],
        ["CapsLock", "Insert", "F1", "F2", "F3", "F12",        "WwwBack", "MyComputer", "Calculator", "WM(R,LGui)", "WM(L,LGui)", "AudioMute"],
        ["ScrollLock", "Pause", "_", "_", "_", "_",            "_", "LCtrl", "LShift", "LAlt", "BrightnessDown", "AudioVolDown"]
    ],

    #4 Nav + Shortcuts
    [
        ["_", "_", "WM(V, LCtrl|LShift)", "WM(V, LCtrl)", "WM(C, LCtrl)", "WM(X, LCtrl)",      "WM(X, LCtrl)", "WM(C, LCtrl)", "WM(V, LCtrl)", "WM(V, LCtrl|LShift)", "_", "_"],
        ["WM(Z, LCtrl)", "WM(Y, LCtrl)", "LAlt", "LShift", "LCtrl", "WwwForward",              "WwwForward", "Left", "UP", "Down", "WM(Z, LCtrl)", "WM(Y, LCtrl)"],
        ["WM(F, LCtrl)", "LGui", "MouseWheelDown", "MouseWheelUp", "MouseRight", "WwwBack",    "WwwBack", "Home", "PageUp", "PageDown", "Right", "WM(F, LCtrl)"],
        ["WM(H, LCtrl)", "MouseWheelLeft", "_", "MouseBtn1", "MouseBtn2", "MouseBtn3",         "_", "LCtrl", "LShift", "LAlt", "End", "WM(H, LCtrl)"]
    ],

    #5 Mouse
    [
        ["_", "_", "_", "_", "_", "_",    "_", "_", "_", "_", "_", "_"],
        ["_", "_", "_", "_", "_", "_",    "_", "MouseLeft", "MouseUp", "MouseDown", "_", "_"],
        ["_", "_", "_", "_", "_", "_",    "_", "MouseWheelLeft", "MouseWheelUp", "MouseWheelDown", "MouseRight", "_"],
        ["_", "_", "_", "_", "_", "_",    "_", "MouseBtn3", "MouseBtn1", "MouseBtn2", "MouseWheelRight", "_"]
    ]

    # #0 QWERTY like layer
    # [
    #     ["__", "__", "W", "E", "R", "T",                                   "Y", "U", "I", "O", "__", "__"],
    #     ["Escape", "Q", "MT(S,LAlt)", "MT(D,LShift)", "MT(F,LCtrl)", "G",  "H", "MT(J,RCtrl)", "MT(K,RShift)", "MT(L,LAlt)", "P", "Backspace"],
    #     ["LCtrl", "MT(A,LGui)", "X", "C", "V", "B",                        "N", "M", "Comma", "Dot", "MT(Semicolon,RGui)", "Enter"],
    #     ["LShift", "Z", "__", "LT(7,Escape)", "LT(5,Space)", "LT(6,Tab)",  "__", "LT(3,Enter)", "LT(2,Backspace)", "LT(4,Delete)", "Slash", "LAlt"]
    # ],

    # #1 homrow mods
    # [
    #     ["_", "_", "_", "_", "_", "_",                                   "_", "_", "_", "_", "_", "_"],
    #     ["_", "_", "MT(S,LAlt)", "MT(T,LShift)", "MT(R,LCtrl)", "_",     "_", "MT(N,RCtrl)", "MT(A,RShift)", "MT(E,LAlt)", "_", "_"],
    #     ["_", "MT(C,LGui)", "_", "_", "_", "_",                          "_", "_", "_", "_", "MT(I,RGui)", "_"],
    #     ["_", "_", "_", "_", "_", "_",                                   "_", "_", "_", "_", "_", "_"]
    # ],

    # #2 Numpad
    # [
    #     ["_", "_", "Kp7", "Kp8", "Kp9", "KpMinus",                       "_", "_", "_", "_", "_", "_"],
    #     ["WM(Comma, LShift)", "KpPlus", "Kp4", "Kp5", "Kp6", "Kp0",      "_", "_", "_", "_", "_", "_"], 
    #     ["Equal", "KpAsterisk", "Kp1", "Kp2", "Kp3", "KpDot",            "_", "_", "_", "_", "_", "_"],
    #     ["WM(Dot, LShift)", "KpSlash", "_", "_", "_", "_",               "_", "_", "_", "_", "_", "_"]
    # ],

    # #7 Media
    # [
    #     ["_", "_", "_", "_", "_", "_",    "WwwRefresh", "MediaPrevTrack", "MediaNextTrack", "Bootloader", "_", "_"],
    #     ["_", "_", "_", "_", "_", "_",    "_", "MediaPlayPause", "MediaStop", "TG(1)", "BrightnessUp", "AudioVolUp"],
    #     ["_", "_", "_", "_", "_", "_",    "_", "MyComputer", "Calculator", "WM(R,LGui)", "WM(L,LGui)", "AudioMute"],
    #     ["_", "_", "_", "_", "_", "_",    "_", "_", "_", "_", "BrightnessDown", "AudioVolDown"]
    # ]
]

[behavior.combo]
timeout = "150ms"
combos = [
  { actions = ["O", "U"], output = "RightBracket" }, #ú
  { actions = ["Y", "O"], output = "Backslash" }, #ű
  { actions = ["W", "J"], output = "TG(1)" } #switch en/hun mode  
]

[behavior.fork]
forks = [
  # Shift + '.' output ':' key
  { trigger = "Dot", negative_output = "Dot", positive_output = "WM(Semicolon, LShift)", match_any = "LShift|RShift" },

  # Shift + ',' output ';' key but only if no Alt is pressed
  { trigger = "Comma", negative_output = "Comma", positive_output = "Semicolon", match_any = "LShift|RShift", match_none = "LAlt|RAlt" },  
  
  # left bracket outputs by default '{', with shifts pressed outputs '['  
  { trigger = "LeftBracket", negative_output = "WM(LeftBracket, LShift)", positive_output = "LeftBracket", match_any = "LShift|RShift" },

  # flip the effect of shift on 'x'/'X'
  { trigger = "X", negative_output = "WM(X, LShift)", positive_output = "X", match_any = "LShift|RShift" },

  # F24 usually outputs 'a', except when Left Shift or Ctrl pressed, in that case triggers a macro 
  { trigger = "F24", negative_output = "A", positive_output = "Macro1", match_any = "LShift|LCtrl" },

  # swap Z and Y keys if MouseBtn1 is pressed (on the keyboard)  
  { trigger = "Y", negative_output = "Y", positive_output = "Z", match_any = "CapsLock" },
  { trigger = "Z", negative_output = "Z", positive_output = "Y", match_any = "CapsLock" },

  # Shift + Backspace output Delete key (inside a layer tap/hold)
  { trigger = "LT(2,Backspace)", negative_output = "LT(2,Backspace)", positive_output = "LT(2,Delete)", match_any = "LShift|RShift" },

  # Ctrl + play/pause will send next track. MediaPlayPause -> MediaNextTrack
  # Ctrl + Shift + play/pause will send previous track. MediaPlayPause -> MediaPrevTrack
  # Alt + play/pause will send volume up. MediaPlayPause -> AudioVolUp
  # Alt + Shift + play/pause will send volume down. MediaPlayPause -> AudioVolDown
  # Ctrl + Alt + play/pause will send brightness up. MediaPlayPause -> BrightnessUp
  # Ctrl + Alt + Shift + play/pause will send brightness down. MediaPlayPause -> BrightnessDown
  # ( Note that the trigger and immediate trigger keys of the fork chain could be 'virtual keys', 
  #   which will never output, like F23 but here multiple overrides demonstrate.)
  { trigger = "MediaPlayPause", negative_output = "MediaPlayPause", positive_output = "MediaNextTrack", match_any = "LCtrl|RCtrl", bindable = true },
  { trigger = "MediaNextTrack", negative_output = "MediaNextTrack", positive_output = "BrightnessUp", match_any = "LAlt|RAlt", bindable = true },
  { trigger = "BrightnessUp", negative_output = "BrightnessUp", positive_output = "BrightnessDown", match_any = "LShift|RShift", bindable = false },
  { trigger = "MediaNextTrack", negative_output = "MediaNextTrack", positive_output = "MediaPrevTrack", match_any = "LShift|RShift", match_none = "LAlt|RAlt", bindable = false},
  { trigger = "MediaPlayPause", negative_output = "MediaPlayPause", positive_output = "AudioVolUp", match_any = "LAlt|RAlt", match_none = "LCtrl|RCtrl", bindable = true },
  { trigger = "AudioVolUp", negative_output = "AudioVolUp", positive_output = "AudioVolDown", match_any = "LShift|RShift", match_none = "LCtrl|RCtrl", bindable = false } 

#   { trigger = "P", negative_output = "P", positive_output = "F", match_any = "LCtrl|RCtrl", bindable = true },
#   { trigger = "F", negative_output = "F", positive_output = "B", match_any = "LAlt|RAlt", bindable = true },
#   { trigger = "B", negative_output = "B", positive_output = "D", match_any = "LShift|RShift", bindable = false },
#   { trigger = "F", negative_output = "F", positive_output = "R", match_any = "LShift|RShift", match_none = "LAlt|RAlt", bindable = false},
#   { trigger = "P", negative_output = "P", positive_output = "V", match_any = "LAlt|RAlt", match_none = "LCtrl|RCtrl", bindable = true },
#   { trigger = "V", negative_output = "V", positive_output = "W", match_any = "LShift|RShift", match_none = "LCtrl|RCtrl", bindable = false } 
]

[storage]
enabled = true
#clear_storage = true
# Storage feature is enabled by default
# Start address of local storage, MUST BE start of a sector.
# If start_addr is set to 0(this is the default value), the last `num_sectors` sectors will be used.
# start_addr = 0x00000000
# How many sectors are used for storage, the default value is 2
# num_sectors = 2

[ble]
enabled = true
# nRF52840's saadc pin for reading battery level, you can use a pin number or "vddh"
#battery_adc_pin = "vddh"
# The voltage divider setting for saadc. 
# For example, nice!nano have 806 + 2M resistors, the saadc measures voltage on 2M resistor, so the two values should be set to 2000 and 2806
#adc_divider_measured = 2000
#adc_divider_total = 2806
# Pin that reads battery's charging state, `low-active` means the battery is charging when `charge_state.pin` is low
#charge_state = { pin = "PIN_1", low_active = true }
# Output LED pin that blinks when the battery is low
#charge_led= { pin = "PIN_2", low_active = true }

# [behavior.one_shot]
# timeout = "2s"

[behavior]
tap_hold = { enable_hrm = true, prior_idle_time = "120ms", hold_timeout = "300ms", post_wait_time = "50ms"}
#enable_hrm = true

# tri_layer = { upper = 1, lower = 2, adjust = 3 }
# one_shot = { timeout = "1s" }
# # Enable HRM 
# tap_hold = { enable_hrm = true, prior_idle_time = "120ms", hold_timeout = "250ms", post_wait_time = "50ms"}
# # Disable HRM, you can safely ignore any fields if you don't want to change them
# tap_hold = { enable_hrm = false, hold_timeout = "200ms" }
# [behavior.one_shot]
# timeout = "5s"

[light]
capslock = { pin = "P1_00", low_active = true }
scrolllock = { pin = "P0_22", low_active = true }
numslock = { pin = "P0_24", low_active = true }

# Dependency config
# [dependency]
# Whether to enable defmt, set to false for reducing binary size 
# defmt_log = true

[split]
connection = "ble" # "serial"

[split.central]
rows = 4 #5
cols = 6
row_offset = 0
col_offset = 6
ble_addr = [0x18, 0xe2, 0x21, 0x80, 0xc0, 0xc7]
[split.central.matrix]
matrix_type = "normal"
row2col = true
output_pins = ["P0_29", "P0_02", "P1_15", "P1_13"]
input_pins = ["P1_11", "P0_10", "P0_09", "P1_06", "P1_04", "P0_11"]

[[split.peripheral]]
rows = 4 #5
cols = 6
row_offset = 0
col_offset = 0
ble_addr = [0x7e, 0xfe, 0x73, 0x9e, 0x66, 0xe3]
[split.peripheral.matrix]
matrix_type = "normal"
row2col = true
output_pins = ["P0_29", "P0_02", "P1_15", "P1_13"]
input_pins = ["P0_11", "P1_04", "P1_06", "P0_09", "P0_10", "P1_11"]
